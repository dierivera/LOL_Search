<!DOCTYPE html>	

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="format-detection" content="telephone=no" />
	<meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="js/angular/angular.js"></script>
	<link href="css/ionic.css" rel="stylesheet">
	<link href="css/ionicons/css/ionicons.css" rel="stylesheet">
	<script src="js/ionic.bundle.js"></script>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<title>League of Legends</title>	
  </head>
  <body>
	
	<!-- Titulo y Subtitulo del sitio-->
	<div class="bar bar-header bar-positive has-tabs-top">
    <h1 class="title">LOL Dashboard</h1>
	</div>
	<div class="bar bar-subheader bar-calm">
		<h2 class="title">Is that a Rocket in your Pocket?</h2>
	</div>
	TEXT
		<ul class="list">
			<li class="item">
				Hidden text
			</li>
		</ul>
	<!-- Menu navegable inferior-->
	<div class="tabs tabs-icon-top tabs-color-positive">
	  <a class="tab-item"  href="index.html">
		<i class="icon ion-home"></i>
		Home
	  </a>
	  <a class="tab-item"  href="#">
		<i class="icon ion-information-circled"></i>
		About
	  </a>
	  <a class="tab-item"  href="#">
		<i class="icon ion-gear-a"></i>
		Settings
	  </a>
	</div>
	
	
	<!-- Recibe los datos del usuario -->
	<div id="userContainer" class="list card">
		<div id="userInformationDiv" class="item item-avatar">
		</div>
	</div>

	<div id="soloQueue" class="list card">
	</div>
	
	<div id="teamRanked" class="list card">
	</div>
	

	
	
	<!--div class="list">
		<table class="table">
			<tr class="thumbnail">
			<td id= "soloQueue" class="list-group"></td>
			<td id= "teamRanked" class="list-group"></td>
			</tr>
		</table>
	</div-->	
		
	
	<!-- Muestra el current Game -->
	<div id= "currentGame" class="list card" >
		<div id = "gameInfo" class="item item-text-wrap">
			<!-- Aqui se muestra si es ranked normal aram y el mapa -->
		</div>
	</div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
	<script>
	
		//Priority ladder, ranked
		
		var rankedPrior = [
			{"Name":"BRONZE","Value":1},
			{"Name":"SILVER","Value":2},
			{"Name":"GOLD","Value":3},
			{"Name":"PLATINUM","Value":4},
			{"Name":"DIAMOND","Value":5},
			{"Name":"MASTER","Value":6},
			{"Name":"CHALLENGER","Value":7}
		];
		
		var maps = [
			{"Name":"The Proving Grounds","Value":3},
			{"Name":"The Crystal Scar","Value":8},	
			{"Name":"Twisted Treeline","Value":10},	
			{"Name":"Summoner's Rift","Value":11},
			{"Name":"Howling Abyss","Value":12},
			{"Name":"Butcher's Bridge", "Value":14}
		];
		
		var spells = [
			{"Name":"exhaust","Value":3},
			{"Name":"flash","Value":4},
			{"Name":"heal","Value":7},
			{"Name":"smite","Value":11},
			{"Name":"teleport","Value":12},
			{"Name":"barrier","Value":21}
		];
		
		var champions = [
			{"Value":35,   "Name": "Shaco"},     
			{"Value":36,   "Name": "DrMundo"},     
			{"Value":33,   "Name": "Rammus"},     
			{"Value":34,   "Name": "Anivia"},     
			{"Value":39,   "Name": "Irelia"},     
			{"Value":157,  "Name":  "Yasuo"},     
			{"Value":37,   "Name": "Sona"},     
			{"Value":38,   "Name": "Kassadin"},     
			{"Value":154,  "Name":  "Zac"},     
			{"Value":150,  "Name":  "Gnar"},     
			{"Value":43,   "Name": "Karma"},     
			{"Value":42,   "Name": "Corki"},     
			{"Value":41,   "Name": "Gangplank"},     
			{"Value":40,   "Name": "Janna"},     
			{"Value":201,  "Name":  "Braum"},     
			{"Value":22,   "Name": "Ashe"},     
			{"Value":23,   "Name": "Tryndamere"},     
			{"Value":24,   "Name": "Jax"},     
			{"Value":25,   "Name": "Morgana"},     
			{"Value":26,   "Name": "Zilean"},     
			{"Value":27,   "Name": "Singed"},     
			{"Value":28,   "Name": "Evelynn"},     
			{"Value":29,   "Name": "Twitch"},     
			{"Value":3,    "Name":"Galio"},     
			{"Value":161,  "Name":  "Velkoz"},     
			{"Value":2,    "Name":"Olaf"},     
			{"Value":1,    "Name":"Annie"},     
			{"Value":7,    "Name":"Leblanc"},     
			{"Value":30,   "Name": "Karthus"},     
			{"Value":6,    "Name":"Urgot"},     
			{"Value":32,   "Name": "Amumu"},     
			{"Value":5,    "Name":"XinZhao"},     
			{"Value":31,   "Name": "Chogath"},     
			{"Value":4,    "Name":"TwistedFate"},     
			{"Value":9,    "Name":"FiddleSticks"},     
			{"Value":8,    "Name":"Vladimir"},     
			{"Value":19,   "Name": "Warwick"},     
			{"Value":17,   "Name": "Teemo"},     
			{"Value":18,   "Name": "Tristana"},     
			{"Value":15,   "Name": "Sivir"},     
			{"Value":16,   "Name": "Soraka"},     
			{"Value":13,   "Name": "Ryze"},     
			{"Value":14,   "Name": "Sion"},     
			{"Value":11,   "Name": "MasterYi"},     
			{"Value":12,   "Name": "Alistar"},     
			{"Value":21,   "Name": "MissFortune"},     
			{"Value":20,   "Name": "Nunu"},     
			{"Value":107,  "Name":  "Rengar"},     
			{"Value":106,  "Name":  "Volibear"},     
			{"Value":105,  "Name":  "Fizz"},     
			{"Value":104,  "Name":  "Graves"},     
			{"Value":103,  "Name":  "Ahri"},     
			{"Value":99,   "Name": "Lux"},     
			{"Value":102,  "Name":  "Shyvana"},     
			{"Value":101,  "Name":  "Xerath"},     
			{"Value":412,  "Name":  "Thresh"},     
			{"Value":98,   "Name": "Shen"},     
			{"Value":222,  "Name":  "Jinx"},     
			{"Value":96,   "Name": "KogMaw"},     
			{"Value":223,  "Name":  "TahmKench"},     
			{"Value":92,   "Name": "Riven"},     
			{"Value":91,   "Name": "Talon"},     
			{"Value":90,   "Name": "Malzahar"},     
			{"Value":429,  "Name":  "Kalista"},     
			{"Value":10,   "Name": "Kayle"},     
			{"Value":421,  "Name":  "RekSai"},     
			{"Value":89,   "Name": "Leona"},     
			{"Value":79,   "Name": "Gragas"},     
			{"Value":117,  "Name":  "Lulu"},     
			{"Value":114,  "Name":  "Fiora"},     
			{"Value":78,   "Name": "Poppy"},     
			{"Value":115,  "Name":  "Ziggs"},     
			{"Value":77,   "Name": "Udyr"},     
			{"Value":112,  "Name":  "Viktor"},     
			{"Value":113,  "Name":  "Sejuani"},     
			{"Value":110,  "Name":  "Varus"},     
			{"Value":111,  "Name":  "Nautilus"},     
			{"Value":119,  "Name":  "Draven"},     
			{"Value":432,  "Name":  "Bard"},     
			{"Value":245,  "Name":  "Ekko"},     
			{"Value":82,   "Name": "Mordekaiser"},     
			{"Value":83,   "Name": "Yorick"},     
			{"Value":80,   "Name": "Pantheon"},     
			{"Value":81,   "Name": "Ezreal"},     
			{"Value":86,   "Name": "Garen"},     
			{"Value":84,   "Name": "Akali"},     
			{"Value":85,   "Name": "Kennen"},     
			{"Value":67,   "Name": "Vayne"},     
			{"Value":126,  "Name":  "Jayce"},     
			{"Value":69,   "Name": "Cassiopeia"},     
			{"Value":127,  "Name":  "Lissandra"},     
			{"Value":68,   "Name": "Rumble"},     
			{"Value":121,  "Name":  "Khazix"},     
			{"Value":122,  "Name":  "Darius"},     
			{"Value":120,  "Name":  "Hecarim"},     
			{"Value":72,   "Name": "Skarner"},     
			{"Value":236,  "Name":  "Lucian"},     
			{"Value":74,   "Name": "Heimerdinger"},     
			{"Value":75,   "Name": "Nasus"},     
			{"Value":238,  "Name":  "Zed"},     
			{"Value":76,   "Name": "Nidalee"},     
			{"Value":134,  "Name":  "Syndra"},     
			{"Value":133,  "Name":  "Quinn"},     
			{"Value":59,   "Name": "JarvanIV"},     
			{"Value":58,   "Name": "Renekton"},     
			{"Value":57,   "Name": "Maokai"},     
			{"Value":56,   "Name": "Nocturne"},     
			{"Value":55,   "Name": "Katarina"},     
			{"Value":64,   "Name": "LeeSin"},     
			{"Value":62,   "Name": "MonkeyKing"},     
			{"Value":63,   "Name": "Brand"},     
			{"Value":268,  "Name":  "Azir"},     
			{"Value":267,  "Name":  "Nami"},     
			{"Value":60,   "Name": "Elise"},     
			{"Value":131,  "Name":  "Diana"},     
			{"Value":61,   "Name": "Orianna"},     
			{"Value":266,  "Name":  "Aatrox"},     
			{"Value":143,  "Name":  "Zyra"},     
			{"Value":48,   "Name": "Trundle"},     
			{"Value":45,   "Name": "Veigar"},     
			{"Value":44,   "Name": "Taric"},     
			{"Value":51,   "Name": "Caitlyn"},     
			{"Value":53,   "Name": "Blitzcrank"},     
			{"Value":54,   "Name": "Malphite"},     
			{"Value":254,  "Name":  "Vi"},     
			{"Value":50,   "Name": "Swain"}
		];
		
		
		
				
		var matchMaking = [
			{"Name":"CUSTOM","Value":0},
			{"Name":"NORMAL_3x3","Value":8},
			{"Name":"NORMAL","Value":2},
			{"Name":"NORMAL_5x5_DRAFT","Value":14},
			{"Name":"RANKED SOLO/DUO","Value":4},
			{"Name":"RANKED_TEAM_3x3","Value":41},
			{"Name":"RANKED TEAM","Value":42},
			{"Name":"ODIN_5x5_BLIND","Value":16},
			{"Name":"ODIN_5x5_DRAFT","Value":17},
			{"Name":"BOT_ODIN_5x5","Value":25},
			{"Name":"BOT_5x5_INTRO","Value":31},
			{"Name":"BOT_5x5_BEGINNER","Value":32},
			{"Name":"BOT_5x5_INTERMEDIATE","Value":33},
			{"Name":"BOT_TT_3x3","Value":52},
			{"Name":"GROUP_FINDER_5x5","Value":61},
			{"Name":"ARAM_5x5","Value":65},
			{"Name":"ONEFORALL_5x5","Value":70},
			{"Name":"SR_6x6","Value":75},
			{"Name":"URF_5x5","Value":76},
			{"Name":"BOT_URF_5x5","Value":83},
			{"Name":"NIGHTMARE_BOT_5x5_RANK1","Value":91},
			{"Name":"NIGHTMARE_BOT_5x5_RANK2","Value":92},
			{"Name":"NIGHTMARE_BOT_5x5_RANK5","Value":93},
			{"Name":"ASCENSION_5x5","Value":96},
			{"Name":"HEXAKILL","Value":98},
			{"Name":"BILGEWATER_ARAM_5x5","Value":100},
			{"Name":"KING_PORO_5x5","Value":300},
			{"Name":"COUNTER_PICK","Value":310},
			{"Name":"BILGEWATER_5x5","Value":313}
		];
		
		
		 
   
		
		$(document).ready(function() {
			$('#userContainer').hide(0);
			$('#gameInfo').hide(0);
			$('#soloQueue').hide(0);
			$('#teamRanked').hide(0);
			
			});
		//reads data from the url
		var getUrlParameter = function getUrlParameter(sParam) {
			var sPageURL = decodeURIComponent(window.location.search.substring(1)),
				sURLVariables = sPageURL.split('&'),
				sParameterName,
				i;

			for (i = 0; i < sURLVariables.length; i++) {
				sParameterName = sURLVariables[i].split('=');

				if (sParameterName[0] === sParam) {
					return sParameterName[1] === undefined ? true : sParameterName[1];
				}
			}
		};
		
		//Changes the name of the Region to be displayed more user friendly
		function changeRegion()
		{
		if (region == "NA")
				new_region = "North America";
		if (region == "LAN")
				new_region = "Latin American North";
		if (region == "LAS")
				new_region = "Latin American South";
		if (region == "EUW")
				new_region = "Europe West";
		return new_region;
		}
		
		//Used to satisfy the current game api query
		function currentPlatform()
		{
		if (region == "NA")
				platform = "NA1";
		if (region == "LAN")
				platform = "LA1";
		if (region == "LAS")
				platform = "LA2";
		if (region == "EUW")
				platform = "EUW1";
		return platform;
		}
		
		//returns the map name
		function getMapName (mapId)
		{
			for (i = 0; i < maps.length;i++)
			{
				if (maps[i].Value == mapId){
					console.log (maps[i].Name);
					return maps[i].Name;
				}
			}
			return "";
		}
		
		//returns the champion name by Id
		function getChampionName (championId)
		{
			for (i = 0; i < champions.length;i++)
			{
				if (champions[i].Value == championId){
					console.log (champions[i].Name);
					return champions[i].Name;
				}
			}
			return "";
		}
		
		//returns the match type name
		function getMatchType (matchId)
		{
			for (i = 0; i < matchMaking.length;i++)
			{
				if (matchMaking[i].Value == matchId){
					console.log (matchMaking[i].Name);
					return matchMaking[i].Name;
				}
			}
			return "";
		}
		
		function createPlayer(playerJsonObject)
		{
			var player =  {
				championId : playerJsonObject.championId,
				spell1Id : playerJsonObject.spell1Id,
				spell2Id : playerJsonObject.spell2Id,
				summonerName : playerJsonObject.summonerName,
				teamId : playerJsonObject.teamId
			};
			return player;
		}
		
		//Store the username and region inserted by user
		var APIKEY = '?api_key=c54efbf8-df0e-4f6e-bc65-e616754052bd';
		var user = getUrlParameter('userName');
		var userId = '';
		var region = getUrlParameter('region');
		var new_region = changeRegion();
		//Used in current game information
		var platform = currentPlatform();
		
		//Ranked information variables
		var teamTierValue = 0;
		var teamTier = "";
		var teamDivision = 0;
		var teamKey = 0;


		
		//01 Gets the user data from the Riot API
	    $.getJSON('https://' + region + '.api.pvp.net/api/lol/' + region.toLowerCase() + '/v1.4/summoner/by-name/' + user + APIKEY ,function(data) {
			console.log(data[user].name);
			//console.log(userId);
			$('#userInformationDiv').html('<img src=http://avatar.leagueoflegends.com/'+ region + "/" + data[user].name.replace(/ /g,'%20') + '.png><h2>' + data[user].name+'</h2>' + '<p>' + new_region + '<span class="badge">Level ' + data[user].summonerLevel + '</span>' + '</p>');			
			//$('#userInformation').html('<h4><span class="label label-primary">' + new_region + '</span> <span class="badge">Level ' + data[user].summonerLevel + '</span> </h4>');
			$('#userContainer').show();
			userId = data[user].id;
		}).done(function() { //espera a que termine para iniciar el 02.
			
		//02 Gets the user's league information
		$.getJSON('https://'+ region + '.api.pvp.net/api/lol/' + region.toLowerCase() + '/v2.5/league/by-summoner/' + userId + '/entry' + APIKEY ,function(data) {
			for (var key in data[userId])
			{
				//console.log(key); //este itera por la cantidad de ranked teams + 1(soloqeue)
				if (key!=0){
					var tier = data[userId][key].tier;
					var division = data[userId][key].entries[0].division;
					var teamName = data[userId][key].entries[0].playerOrTeamName;
					if (!teamDivision){
						teamTier = tier;
						teamDivision = division;
						teamKey = key;
					}
					else{
						for(var i=0;i<rankedPrior.length;i++){
							if (rankedPrior[i].Name == tier)
							{
								if (teamDivision > division)
								{
									teamTier = tier;
									teamDivision = division;
									teamTierValue = i;
									teamKey = key;
								}
							}
							else //revisa si esta en una liga distinta
							{
								if (teamTierValue > i)
									{}
								else
								{
									teamTier = tier;
									teamDivision = division;
									teamTierValue = i;
									teamKey = key;
								}
							}
						}
					}
			   }				   
			}
			//console.log(teamName + " - " + teamTier + " " + teamDivision );
			//var soloqeue = '<li class="list-group-item active">Ranked Solo Queue</li> <li class="list-group-item">' + data[userId][0].name + '</li><li class="list-group-item"> <img src=res/Leagues/' + data[userId][0].tier.toLowerCase() + data[userId][0].entries[0].division +'.png alt="soloRanked"> </li><li class="list-group-item">' + data[userId][0].tier + " " + data[userId][0].entries[0].division  + '</li><li  class="list-group-item"> League Points: ' + data[userId][0].entries[0].leaguePoints + '</li><li  class="list-group-item"> W: ' + data[userId][0].entries[0].wins + " L: " + data[userId][0].entries[0].losses;			
			var soloqeue = '<div class="item item-text-wrap"><i class="icon ion-person"></i><b> Ranked SoloQueue</b>' + '</div><div class = "row"><div id="imagenLigaYNombre" class="item item-image col col-50"><img src=res/Leagues/' + data[userId][0].tier.toLowerCase()  +  data[userId][0].entries[0].division +'.png alt="soloRanked" style="width: 50%; height: 50%"><p><b>' + data[userId][0].tier + " " + data[userId][0].entries[0].division  + '</b></p></div><div id="InformaciondelUsuario" class="item item-image col col-50"><p>&nbsp;</p><p>'+ data[userId][0].name.toUpperCase().bold() + '</p><p>LEAGUE POINTS: ' + data[userId][0].entries[0].leaguePoints + '</p><p>W: ' + data[userId][0].entries[0].wins +  " L: " + data[userId][0].entries[0].losses + '</p></div></div>';
			
			
			
			
			
			var teamqeue = '<div class="item item-text-wrap"><i class="icon ion-ios-people"></i><b> Ranked Team</b>&nbsp;-&nbsp;'+ teamName.bold() + '</div><div class = "row"><div id="imagenLigaYNombre" class="item item-image col col-50"><img src=res/Leagues/' + teamTier.toLowerCase() +  teamDivision +'.png alt="teamRanked" style="width: 50%; height: 50%"><p><b>' + teamTier + " " +  teamDivision + '</b></p></div><div id="InformaciondelUsuario" class="item item-image col col-50"><p>&nbsp;</p><p>'+ data[userId][teamKey].name.toUpperCase().bold() + '</p><p>LEAGUE POINTS: ' + data[userId][teamKey].entries[0].leaguePoints + '</p><p>W: ' + data[userId][teamKey].entries[0].wins +  " L: " + data[userId][teamKey].entries[0].losses + '</p></div></div>';
			//var teamqeue = '<li class="list-group-item active">Ranked Team - ' + teamName.bold() +'</li> <li class="list-group-item">' + data[userId][teamKey].name + '</li><li class="list-group-item"> <img src=res/Leagues/' + teamTier.toLowerCase() +  teamDivision +'.png alt="soloRanked"></li><li class="list-group-item">' + teamTier + " " +  teamDivision + '</li><li  class="list-group-item"> League Points: ' + data[userId][teamKey].entries[0].leaguePoints + '</li><li  class="list-group-item"> W: ' + data[userId][teamKey].entries[0].wins + " L: " + data[userId][teamKey].entries[0].losses;
			//$('#userInformation').append('<h4><span class="label label-primary"> Ranked SoloQueue: ' + data[userId][0].name + data[userId][0].tier + data[userId][0].entries[0].division 	  + '</span> </h4>');
			$('#soloQueue').append(soloqeue);
			$('#teamRanked').append(teamqeue);
			$('#soloQueue').show();
			$('#teamRanked').show();
		});
		
		//03 Gets the user's current game
		$.getJSON('https://'+ region + '.api.pvp.net/observer-mode/rest/consumer/getSpectatorGameInfo/' + platform  + '/' + userId + APIKEY ,function(data) {
		//$.getJSON('https://lan.api.pvp.net/api/lol/lan/v2.2/match/189274524?api_key=c54efbf8-df0e-4f6e-bc65-e616754052bd' ,function(data) {
			var mapName = getMapName(data.mapId);
			var matchTypeName = getMatchType(data.gameQueueConfigId);
			var player01 = data['participants'][0].summonerName;
			console.log(matchTypeName);
			$('#gameInfo').html('<b>' + matchTypeName +' · '+ mapName + '</b>');
			$('#gameInfo').show();
			//userId = data[user].id;
			//getChampionName(data['participants'][0].championId)
			var i,j;
			for (i=0,j= 5; i<5; i++,j++){
				var row01 = '<div class="row"><div class="col col-50"><div class="item item-avatar"><img src="res/ChampionsSquare/'+getChampionName(data['participants'][i].championId)+'Square.png"><p>'+ data["participants"][i].summonerName +'</p></div></div><div class="col col-50"><div class="item item-avatar"><img src="res/ChampionsSquare/'+getChampionName(data["participants"][j].championId)+'Square.png"><p>'+ data["participants"][j].summonerName +'</p></div></div></div>';
				$('#currentGame').append(row01);
			}
			$('#currentGame').show();
			});
		
		});//ends the done
		
		
		
		
		
		
		
		
		
		
			
		
		
		
		
		
		
		
		
		

	</script>
  </body>
	
</html>